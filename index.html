<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>विपेन्द्र प्रसाद सिन्हा - रोह पंचायत</title>

<meta http-equiv="Content-Security-Policy"
content="default-src 'self' https://*.firebaseio.com https://www.gstatic.com https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com">

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
body{font-family:'Mukta',sans-serif;background:#f8fafc}
.page{display:none}
.page.active{display:block}
</style>
</head>

<body>

<!-- NAV -->
<nav class="bg-slate-900 text-white p-4 flex justify-between">
  <b>मुखिया पंचायत</b>
  <button onclick="showPage('login')" class="bg-amber-500 px-4 py-1 rounded">Admin</button>
</nav>

<!-- HOME -->
<section id="home" class="page active p-10 text-center">
  <h1 class="text-5xl font-black">विपेन्द्र प्रसाद सिन्हा</h1>
  <p id="mainShayari" class="text-2xl mt-6">लोड हो रहा है...</p>
  <p id="mainEvent" class="mt-4 text-xl text-slate-600"></p>

  <h3 class="mt-10 text-3xl font-bold">फोटो गैलरी</h3>
  <div id="gallery" class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6"></div>

  <!-- FEEDBACK -->
  <div class="mt-16 max-w-xl mx-auto">
    <h3 class="text-2xl font-black mb-4">आपकी राय मायने रखती है</h3>
    <input id="fname" placeholder="नाम" class="w-full border p-3 mb-3">
    <textarea id="fmsg" placeholder="संदेश" class="w-full border p-3 mb-3"></textarea>
    <button onclick="sendFeedback()" class="bg-green-600 text-white px-6 py-2 rounded">
      भेजें
    </button>
  </div>
</section>

<!-- LOGIN -->
<section id="login" class="page p-10">
  <div class="max-w-md mx-auto bg-white p-8 shadow rounded">
    <h2 class="text-3xl font-black mb-6">Admin Login</h2>
    <input id="email" placeholder="Email" class="w-full border p-3 mb-3">
    <input id="password" type="password" placeholder="Password" class="w-full border p-3 mb-4">
    <button onclick="login()" class="bg-slate-900 text-white w-full py-3 rounded">
      Login
    </button>
  </div>
</section>

<!-- ADMIN -->
<section id="admin" class="page p-10">
  <h2 class="text-3xl font-black mb-6">Admin Dashboard</h2>

  <textarea id="editShayari" class="w-full border p-4 mb-3"></textarea>
  <input id="editEvent" class="w-full border p-3 mb-3">

  <input id="g1" placeholder="Gallery Image URL" class="w-full border p-3 mb-3">

  <button onclick="saveData()" class="bg-amber-500 px-6 py-2 rounded font-bold">
    Save Live
  </button>

  <button onclick="logout()" class="ml-4 bg-red-600 text-white px-4 py-2 rounded">
    Logout
  </button>
</section>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, push } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
 apiKey: "AIzaSyC7RoapoxY0nDoSsfa5mUGzEbaKFLmDQ4Y",
 authDomain: "rohpanchayat.firebaseapp.com",
 databaseURL: "https://rohpanchayat-default-rtdb.firebaseio.com",
 projectId: "rohpanchayat"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

/* LOAD CONTENT */
onValue(ref(db,'content'), snap=>{
 const d = snap.val();
 if(!d) return;
 mainShayari.innerText = d.shayari || "";
 mainEvent.innerText = d.event || "";
 gallery.innerHTML = d.g1 ? `<img loading="lazy" src="${d.g1}">` : "";
 editShayari.value = d.shayari || "";
 editEvent.value = d.event || "";
 g1.value = d.g1 || "";
});

/* LOGIN */
window.login = ()=>{
 signInWithEmailAndPassword(auth,email.value,password.value)
 .then(()=>showPage('admin'))
 .catch(()=>alert("गलत जानकारी"));
}

/* LOGOUT */
window.logout = ()=>{
 signOut(auth);
 showPage('home');
}

/* SAVE */
window.saveData = ()=>{
 set(ref(db,'content'),{
  shayari: editShayari.value,
  event: editEvent.value,
  g1: g1.value
 }).then(()=>alert("Live update सफल"));
}

/* FEEDBACK */
window.sendFeedback = ()=>{
 push(ref(db,'feedback'),{
  name: fname.value,
  msg: fmsg.value,
  time: Date.now()
 }).then(()=>alert("धन्यवाद!"));
}

/* AUTH STATE */
onAuthStateChanged(auth,user=>{
 if(user) showPage('admin');
});

/* NAV */
window.showPage = id=>{
 document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}
</script>

</body>
</html>
